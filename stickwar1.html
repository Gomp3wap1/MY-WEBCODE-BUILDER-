
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ASCII Stick Fight - Column Infantry</title>
<style>
body { background:#111; color:#0f0; font-family:monospace; display:flex; justify-content:center; align-items:center; flex-direction:column; height:100vh; margin:0; }
pre { font-size:18px; line-height:16px; }
.buttons { margin-top:10px; }
button { font-size:16px; margin:2px; padding:8px; background:#222; color:#0f0; border:none; border-radius:4px; }
</style>
</head>
<body>
<pre id="screen"></pre>
<div class="buttons">
<button onclick="press('left')">Left</button>
<button onclick="press('right')">Right</button>
<button onclick="press('jump')">Jump</button>
<button onclick="press('punch')">Punch</button>
<button onclick="press('weapon sword')">Sword</button>
<button onclick="press('weapon bow')">Bow</button>
</div>

<script>
const width = 30;
const height = 12;
const platforms = [
  {x1:0, x2:29, y:height-1},
  {x1:5, x2:20, y:8},
  {x1:22, x2:28, y:5}
];

let player = {x:2, y:height-1, vx:0, vy:0, hp:15, weapon:"fist", attacking:false};
let enemies = [];
let projectiles = [];

// Generate column infantry enemies
for(let col=0; col<2; col++){
    for(let row=0; row<3; row++){
        enemies.push({x:25+col*2, y:height-1-row, vx:0, vy:0, hp:5, attacking:false});
    }
}

const keys = {};
function press(cmd){
    if(cmd==="left") keys["ArrowLeft"]=true;
    if(cmd==="right") keys["ArrowRight"]=true;
    if(cmd==="jump") keys["ArrowUp"]=true;
    if(cmd==="punch") keys["Space"]=true;
    if(cmd.includes("weapon")) player.weapon=cmd.split(" ")[1];
}
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

function isPlatform(x,y){ return platforms.some(p=>y===p.y && x>=p.x1 && x<=p.x2); }

function drawStick(x,y,attacking=false, weapon="fist"){
  const parts=[];
  parts.push({x:x, y:y-2, char:"O"});
  let bodyChar="|";
  if(attacking && weapon=="sword") bodyChar="|->";
  if(attacking && weapon=="bow") bodyChar="|>>";
  parts.push({x:x, y:y-1, char:bodyChar});
  let arms = attacking?["-","-"]:["/","\\"];
  parts.push({x:x-1, y:y-1, char:arms[0]});
  parts.push({x:x+1, y:y-1, char:arms[1]});
  parts.push({x:x-1, y:y, char:"/"});
  parts.push({x:x+1, y:y, char:"\\"});
  return parts;
}

// Game update
function update(){
  // Player movement
  player.vx=0;
  if(keys["ArrowLeft"]) player.vx=-1;
  if(keys["ArrowRight"]) player.vx=1;
  if(keys["ArrowUp"] && isPlatform(player.x,player.y+1)) player.vy=-2;
  player.x += player.vx;
  player.y += player.vy;

  // Gravity
  if(!isPlatform(player.x,player.y+1)) player.vy +=0.2;
  else player.vy=0;
  if(player.y>height-1) player.y=height-1;

  // Player attack
  if(keys["Space"]){
    if(player.weapon=="bow") projectiles.push({x:player.x+1, y:player.y-1, dx:1, owner:"player"});
    else player.attacking=true;
  }

  // Enemy AI: column infantry
  enemies.forEach(e=>{
    if(e.hp<=0) return;
    if(e.x>player.x && !isPlatform(e.x-1,e.y)) e.vx=-0.5;
    else if(e.x<player.x && !isPlatform(e.x+1,e.y)) e.vx=0.5;
    e.x += e.vx;
    if(!isPlatform(e.x,e.y+1)) e.y +=0.2;
    if(Math.abs(e.x-player.x)<=1 && Math.random()<0.02) e.attacking=true;
    // Enemy bow randomly
    if(Math.random()<0.005) projectiles.push({x:e.x-1, y:e.y-1, dx:-1, owner:"enemy"});
  });

  // Attack logic
  if(player.attacking){
    enemies.forEach(e=>{ if(Math.abs(player.x-e.x)<=1) e.hp -= (player.weapon=="sword"?2:1); });
    player.attacking=false;
  }
  enemies.forEach(e=>{ if(e.attacking && Math.abs(player.x-e.x)<=1) player.hp--; e.attacking=false; });

  // Projectiles
  projectiles.forEach(p=>{
    p.x += p.dx;
    if(p.owner=="player") enemies.forEach(e=>{ if(Math.abs(e.x-p.x)<=0.5 && Math.abs(e.y-p.y)<=1){ e.hp--; p.hit=true; } });
    if(p.owner=="enemy"){ if(Math.abs(player.x-p.x)<=0.5 && Math.abs(player.y-p.y)<=1){ player.hp--; p.hit=true; } }
  });
  projectiles = projectiles.filter(p=>!p.hit && p.x>=0 && p.x<width);

  render();
  checkWin();
}

// Render
function render(){
  const grid = Array.from({length:height},()=>Array(width).fill(" "));
  platforms.forEach(p=>{ for(let x=p.x1;x<=p.x2;x++) grid[p.y][x]="#"; });

  drawStick(Math.round(player.x),Math.round(player.y),player.attacking,player.weapon)
    .forEach(p=>{ if(p.x>=0&&p.x<width&&p.y>=0&&p.y<height) grid[Math.round(p.y)][Math.round(p.x)]=p.char; });
  enemies.forEach(e=>{ if(e.hp<=0) return; drawStick(Math.round(e.x),Math.round(e.y),false,"fist")
    .forEach(p=>{ if(p.x>=0&&p.x<width&&p.y>=0&&p.y<height) grid[Math.round(p.y)][Math.round(p.x)]=p.char; }); });
  projectiles.forEach(p=>{ if(p.x>=0&&p.x<width&&p.y>=0&&p.y<height) grid[Math.round(p.y)][Math.round(p.x)]=">"; });

  let output="";
  grid.forEach(row=>output+=row.join("")+"\n");
  output += `Player HP:${player.hp}(${player.weapon})\n`;
  enemies.forEach((e,i)=>output+=`Enemy${i+1} HP:${e.hp}\n`);
  document.getElementById("screen").textContent = output;
}

// Win/lose
function checkWin(){
  if(player.hp<=0){ alert("You lost!"); location.reload(); }
  if(enemies.every(e=>e.hp<=0)){ alert("You win!"); location.reload(); }
}

setInterval(update,100); // arcade loop 10fps
</script>
</body>
</html>
