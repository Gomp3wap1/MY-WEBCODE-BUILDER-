<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate YouTube Search</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="config.js"></script>
<style>
body{padding-top:70px;background:#f9f9f9;}
iframe,img{width:100%;height:180px;object-fit:cover;}
.search-bar{position:fixed;top:0;width:100%;padding:10px;background:white;box-shadow:0 2px 5px rgba(0,0,0,0.1);z-index:1000;}
.attr-list{font-size:0.9rem;padding-left:15px;}
.tab-content{padding-top:10px;}
</style>
</head>
<body>

<div class="search-bar">
  <div class="input-group">
    <input type="text" id="searchInput" class="form-control" placeholder="Search YouTube...">
    <button class="btn btn-primary" onclick="searchYouTube()">Search</button>
  </div>
</div>

<div class="container mt-5">
  <div id="results" class="row g-3"></div>
</div>

<script>
async function searchYouTube(){
  const query = document.getElementById("searchInput").value.trim();
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = `<p class="text-center">Loading...</p>`;

  const { videoDetails, channelDetails, playlistDetails } = await fetchYouTubeSearch(query);

  resultsDiv.innerHTML = "";

  const channelMap = {};
  channelDetails.forEach(c => channelMap[c.id] = c);

  // Display Videos
  for(let i=0;i<videoDetails.length;i++){
    const v = videoDetails[i];
    const channel = channelMap[v.snippet.channelId];
    const tabPrefix = `vid${i}-`;

    const card = document.createElement("div");
    card.className="col-12";
    card.innerHTML=`
      <div class="card video-card">
        <iframe src="https://www.youtube.com/embed/${v.id}" frameborder="0" allowfullscreen></iframe>
        <div class="card-body">
          <h5>${v.snippet.title}</h5>
          <p>${v.snippet.description}</p>
          <p class="text-muted small">${channel?.snippet.title || v.snippet.channelTitle} â€¢ ${v.statistics.viewCount} views</p>

          <ul class="nav nav-tabs">
            ${["Video","Stats","Content","Topic","Status","Channel","Comments"].map((t,idx)=>`
              <li class="nav-item">
                <button class="nav-link ${idx===0?'active':''}" data-bs-toggle="tab" data-bs-target="#${tabPrefix}${idx}">${t}</button>
              </li>`).join("")}
          </ul>

          <div class="tab-content">
            <div class="tab-pane fade show active" id="${tabPrefix}0">
              <ul class="attr-list">
                <li><strong>Title:</strong>${v.snippet.title}</li>
                <li><strong>Description:</strong>${v.snippet.description}</li>
                <li><strong>Tags:</strong>${v.snippet.tags?.join(", ")||"N/A"}</li>
              </ul>
            </div>
            <div class="tab-pane fade" id="${tabPrefix}1">
              <ul class="attr-list">
                <li><strong>Views:</strong>${v.statistics.viewCount}</li>
                <li><strong>Likes:</strong>${v.statistics.likeCount||"N/A"}</li>
                <li><strong>Comments:</strong>${v.statistics.commentCount||"N/A"}</li>
              </ul>
            </div>
            <div class="tab-pane fade" id="${tabPrefix}2">
              <ul class="attr-list">
                <li><strong>Duration:</strong>${v.contentDetails.duration}</li>
                <li><strong>Definition:</strong>${v.contentDetails.definition}</li>
                <li><strong>Captions:</strong>${v.contentDetails.caption}</li>
              </ul>
            </div>
            <div class="tab-pane fade" id="${tabPrefix}3">
              <ul class="attr-list">
                <li><strong>Topics:</strong>${v.topicDetails?.topicCategories?.join(", ")||"N/A"}</li>
              </ul>
            </div>
            <div class="tab-pane fade" id="${tabPrefix}4">
              <ul class="attr-list">
                <li><strong>Privacy:</strong>${v.status.privacyStatus}</li>
                <li><strong>Embeddable:</strong>${v.status.embeddable}</li>
                <li><strong>License:</strong>${v.status.license}</li>
              </ul>
            </div>
            <div class="tab-pane fade" id="${tabPrefix}5">
              <ul class="attr-list">
                <li><strong>Channel:</strong>${channel?.snippet.title}</li>
                <li><strong>Subscribers:</strong>${channel?.statistics.subscriberCount}</li>
                <li><strong>Total Views:</strong>${channel?.statistics.viewCount}</li>
                <li><strong>Branding:</strong>${channel?.brandingSettings?.image?.bannerExternalUrl||"N/A"}</li>
              </ul>
            </div>
            <div class="tab-pane fade" id="${tabPrefix}6">
              <p>Loading comments...</p>
            </div>
          </div>
        </div>
      </div>
    `;
    resultsDiv.appendChild(card);

    // Load comments
    const commentsDiv = card.querySelector(`#${tabPrefix}6`);
    const comments = await fetchComments(v.id,5);
    commentsDiv.innerHTML = comments.length? `<ul class="attr-list">
      ${comments.map(c=>`<li><strong>${c.snippet.topLevelComment.snippet.authorDisplayName}:</strong> ${c.snippet.topLevelComment.snippet.textDisplay}</li>`).join("")}
    </ul>` : "<p>No comments</p>";
  }

  // TODO: Add Playlists, Live Streams, Shorts, Community tabs in similar card layout
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
